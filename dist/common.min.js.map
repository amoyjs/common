{"version":3,"file":"common.min.js","sources":["../lib/extend.ts","../lib/performance.ts","../lib/index.ts","../lib/eventify.ts","../lib/usesify.ts"],"sourcesContent":["function isPlainObject(object) {\n    // tslint:disable-next-line: one-variable-per-declaration\n    let proto,\n        ctor,\n        class2type = {},\n        toString = class2type.toString, // Object.prototype.toString\n        hasOwn = class2type.hasOwnProperty,\n        fnToString = hasOwn.toString, // Object.toString/Function.toString\n        ObjectFunctionString = fnToString.call(Object) // 'function Object() { [native code] }'\n\n    if (!object || toString.call(object) !== '[object Object]') {\n        return false\n    }\n\n    // According to the object created by `Object.create(null)` is no `prototype`\n    proto = Object.getPrototypeOf(object)\n    if (!proto) {\n        return true\n    }\n\n    ctor = hasOwn.call(proto, 'constructor') && proto.constructor\n    return typeof ctor === 'function' && fnToString.call(ctor) === ObjectFunctionString\n}\n\nexport function extend(this: any, ...args) {\n    let options\n    let name\n    let clone\n    let copy\n    let source\n    let copyIsArray\n    let target = arguments[0] || {}\n    let i = 1\n    let length = arguments.length\n    let deep = false\n\n    if (typeof target === 'boolean') {\n        deep = target\n        target = arguments[i] || {}\n        i++\n    }\n\n    if (typeof target !== 'object' && typeof target !== 'function') {\n        target = {}\n    }\n\n    if (i === length) {\n        target = this\n        i--\n    }\n\n    for (; i < length; i++) {\n        // tslint:disable-next-line: no-conditional-assignment\n        if ((options = arguments[i]) !== null) {\n            for (name in options) {\n                if (options.hasOwnProperty(name)) {\n                    source = target[name]\n                    copy = options[name]\n\n                    if (target === copy) {\n                        continue\n                    }\n\n                    // deep clone\n                    // tslint:disable-next-line: no-conditional-assignment\n                    if (deep && copy && (isPlainObject(copy) || (copyIsArray = Array.isArray(copy)))) {\n                        if (copyIsArray) {\n                            copyIsArray = false\n                            clone = source && Array.isArray(source) ? source : []\n                        } else {\n                            clone = source && isPlainObject(source) ? source : {}\n                        }\n\n                        target[name] = extend(deep, clone, copy)\n                    } else if (copy !== undefined) {\n                        target[name] = copy\n                    }\n                }\n            }\n        }\n    }\n\n    return target\n}\n","\nlet drawCalls: number\nlet fps: number\n\nfunction catchDraws(app: any) {\n    let i = 0\n    app.renderer.addListener('prerender', () => {\n        i = 0\n    })\n    app.renderer.addListener('postrender', () => {\n        drawCalls = i\n    })\n\n    const olGrawElements = app.renderer.gl.drawElements.bind(app.renderer.gl)\n    app.renderer.gl.drawElements = (...args: any[]) => {\n        i++\n        return olGrawElements(...args)\n    }\n}\n\nfunction catchFPS() {\n    let lastTime = performance.now()\n    let frame = 0\n    const loop = () => {\n        const now = performance.now()\n        frame++\n        if (now >= 1000 + lastTime) {\n            fps = Math.round((frame * 1000) / (now - lastTime))\n            frame = 0\n            lastTime = now\n        }\n        requestAnimationFrame(loop)\n    }\n    loop()\n}\n\nfunction createFPSAndDrawCallsPannel(showFps, showDrawCalls) {\n    const container = document.createElement('div')\n    container.id = 'stats'\n    container.style.cssText = `position:fixed;\n        left: 3rem;\n        pointer-events: none;\n        user-select: none;\n        z-index:10000;\n        color: #fff;\n        font-size: 3rem;\n        line-height: 3rem;`\n    container.innerHTML = `${showFps ? \"<p id='fps'>fps:</p>\" : ''}${showDrawCalls ? \"<p id='drawcalls'>drawCalls:</p>\" : ''}`\n    document.body.appendChild(container)\n    const statsContainer = document.querySelector('#stats')\n    const top = window.innerHeight - (statsContainer ? statsContainer.clientHeight : 0)\n    container.style.top = top - 10 + 'px'\n}\n\nfunction handlePannelPosition() {\n    const statsContainer = document.querySelector('#stats')\n    setTimeout(() => {\n        const container = document.getElementById('stats')\n        if (container) {\n            container.style.top = window.innerHeight - (statsContainer ? statsContainer.clientHeight : 0) - 10 + 'px'\n        }\n    }, 100)\n}\n\nexport function showPerformancePannel(app: any, enables: string[] = ['fps', 'draw-calls']) {\n    const showFps = enables.includes('fps')\n    const showDrawCalls = enables.includes('draw-calls')\n    showDrawCalls && catchDraws(app)\n    showFps && catchFPS()\n    createFPSAndDrawCallsPannel(showFps, showDrawCalls)\n\n    const drawCallContainer = document.querySelector('#drawcalls')\n    const fpsContainer = document.querySelector('#fps')\n\n    setInterval(() => {\n        drawCalls && drawCallContainer && (drawCallContainer.innerHTML = `drawCalls: ${drawCalls}`)\n        fps && fpsContainer && (fpsContainer.innerHTML = `fps: ${fps}`)\n    }, 200)\n\n    window.addEventListener('resize', () => handlePannelPosition())\n}\n\nexport function showPerformance(enables: string[] = ['fps', 'draw-calls']) {\n    return (event: any) => event.on('created', ({ game }) => showPerformancePannel(game, enables))\n}\n","export * from \"./eventify\"\nexport * from \"./extend\"\nexport * from \"./usesify\"\nexport * from './performance'\n\nexport function type(object: any) {\n    const class2type = {}\n    const type = class2type.toString.call(object)\n    const typeString = 'Boolean Number String Function Array Date RegExp Object Error Symbol'\n\n    if (object == null) return object + ''\n\n    typeString.split(' ').forEach((type) => {\n        class2type[`[object ${type}]`] = type.toLowerCase()\n    })\n\n    const isObject = typeof object === 'object'\n    const isFn = typeof object === 'function'\n    return isObject || isFn ? class2type[type] || 'object' : typeof object\n}\n\nexport function forin(object: object, fn: (key?: string, value?: any) => void) {\n    if (typeof object === 'object') {\n        for (const key in object) {\n            if (object.hasOwnProperty(key)) {\n                const value = object[key]\n                fn(key, value)\n            }\n        }\n    }\n}\n\nexport const getValue = (root: any, get: string) => {\n    if (type(root) !== 'object') return root\n    let value = root\n    const keyArr = get.split('.')\n    for (let i = 0, l = keyArr.length; i < l; i++) {\n        const v = keyArr[i]\n        if (v) {\n            if (value[v]) {\n                value = value[v]\n            } else {\n                value = undefined\n                break\n            }\n        }\n    }\n    return value\n}\n\nexport const setValue = (tar: any, key: string, value: any) => {\n    if (type(tar) !== 'object') {\n        throw new Error('setValue tar muse be a object!')\n    } else {\n        const pIndex = key.trim().indexOf('.')\n        if (pIndex > 0 && pIndex < key.length - 1) {\n            const keyArr = key.trim().split('.')\n            let _obj = tar\n            let wrongKey = ''\n            for (let i = 0, l = keyArr.length - 1; i < l; i++) {\n                const v = keyArr[i]\n                if (typeof _obj[v] === 'object') {\n                    _obj = _obj[v]\n                } else if (typeof _obj[v] === 'undefined') {\n                    wrongKey = v\n                }\n            }\n\n            if (!wrongKey) {\n                const lastKey = keyArr[keyArr.length - 1]\n                _obj[lastKey] = value\n            } else {\n                throw new Error(`the key(${wrongKey}) is not in tar obj!`)\n            }\n        } else {\n            tar[key.replace(/\\./g, '')] = value\n        }\n    }\n}\n\nexport function getQuery(name: string) {\n    const search = location.search\n    const hasSearch = search !== ''\n    const queryString = hasSearch ? search.slice(1) : ''\n    const queries = queryString.split('&')\n    const query = queries.reduce((prev: any, current: any) => {\n        const [left, right] = current.split('=')\n        prev[left] = decodeURIComponent(right)\n        return prev\n    }, {})\n    return query[name]\n}\n\nexport function isEmpty(target: any) {\n    if (typeof target === 'object') {\n        return Object.keys(target).length === 0\n    } else if (Array.isArray(target) || typeof target === 'string') {\n        return target.length === 0\n    } else {\n        return false\n    }\n}\n","export function eventify(target: any) {\n    target.callbacks = {}\n\n    target.on = (eventName: string, callback: () => void) => {\n        if (!eventName || !callback) return target\n        if (!target.hasOwnProperty(\"callbacks\")) target.callbacks || (target.callbacks = {})\n\n        let base: any\n        const events = eventName.split(\" \")\n        events.map((eventName) => {\n            (base = target.callbacks)[eventName] || (base[eventName] = [])\n            target.callbacks[eventName].push(callback)\n        })\n\n        return target\n    }\n\n    target.emit = (...args: any) => {\n        const eventName = args.shift() as string\n        const events = eventName.split(\" \")\n        events.map((eventName) => {\n            const list = target.callbacks !== null ? target.callbacks[eventName] || [] : []\n            if (list.length) {\n                list.map((item: () => void) => {\n                    item && item.apply(target, args)\n                })\n            }\n        })\n\n        return target\n    }\n\n    target.off = (...args: any) => {\n        if (args.length === 0) {\n            target.callbacks = {}\n        } else {\n            const eventName = args.shift() as string\n            const events = eventName.split(\" \")\n            events.map((eventName) => delete target.callbacks[eventName])\n        }\n\n        return target\n    }\n\n    return target\n}\n","type addon = (core: any) => void\n\nexport function usesify(addons: addon | addon[]) {\n    return function use(target) {\n        const _addons = Array.isArray(addons) ? addons : [addons]\n        _addons.map((addon) => {\n            if (typeof addon === \"function\") {\n                addon(target)\n            } else {\n                throw Error(`[@amoy/components]error: addon ${addons} must be a function;`)\n            }\n        })\n    }\n}\n"],"names":["isPlainObject","object","proto","ctor","class2type","toString","hasOwn","hasOwnProperty","fnToString","ObjectFunctionString","call","Object","getPrototypeOf","constructor","drawCalls","fps","showPerformancePannel","app","enables","lastTime","frame","loop","showFps","includes","showDrawCalls","i","renderer","addListener","olGrawElements","gl","drawElements","bind","_i","args","catchDraws","performance","now","Math","round","requestAnimationFrame","container","document","createElement","id","style","cssText","innerHTML","body","appendChild","statsContainer","querySelector","top","window","innerHeight","clientHeight","createFPSAndDrawCallsPannel","drawCallContainer","fpsContainer","setInterval","addEventListener","setTimeout","getElementById","type","split","forEach","toLowerCase","target","callbacks","on","eventName","callback","map","base","push","emit","shift","list","length","item","apply","off","extend","options","name","clone","copy","source","copyIsArray","arguments","deep","this","Array","isArray","undefined","fn","key","search","location","slice","reduce","prev","current","_a","left","right","decodeURIComponent","root","get","value","keyArr","l","v","keys","tar","Error","pIndex","trim","indexOf","_obj","wrongKey","replace","event","addons","addon"],"mappings":"mMAAA,SAASA,EAAcC,GAEnB,IAAIC,EACAC,EACAC,EAAa,GACbC,EAAWD,EAAWC,SACtBC,EAASF,EAAWG,eACpBC,EAAaF,EAAOD,SACpBI,EAAuBD,EAAWE,KAAKC,QAE3C,OAAKV,GAAoC,oBAA1BI,EAASK,KAAKT,OAK7BC,EAAQS,OAAOC,eAAeX,KAMP,mBADvBE,EAAOG,EAAOI,KAAKR,EAAO,gBAAkBA,EAAMW,cACbL,EAAWE,KAAKP,KAAUM,GCpBnE,IAAIK,EACAC,WA8DYC,EAAsBC,EAAUC,gBAAAA,GAAqB,MAAO,eACxE,IA5CIC,EACAC,EACEC,EA0CAC,EAAUJ,EAAQK,SAAS,OAC3BC,EAAgBN,EAAQK,SAAS,cACvCC,GA/DJ,SAAoBP,GAChB,IAAIQ,EAAI,EACRR,EAAIS,SAASC,YAAY,YAAa,WAClCF,EAAI,IAERR,EAAIS,SAASC,YAAY,aAAc,WACnCb,EAAYW,IAGhB,IAAMG,EAAiBX,EAAIS,SAASG,GAAGC,aAAaC,KAAKd,EAAIS,SAASG,IACtEZ,EAAIS,SAASG,GAAGC,aAAe,eAAC,aAAAE,mBAAAA,IAAAC,kBAE5B,OADAR,IACOG,eAAkBK,IAmDZC,CAAWjB,GAC5BK,IA/CIH,EAAWgB,YAAYC,MACvBhB,EAAQ,GACNC,EAAO,WACT,IAAMe,EAAMD,YAAYC,MACxBhB,IACW,IAAOD,GAAdiB,IACArB,EAAMsB,KAAKC,MAAe,IAARlB,GAAiBgB,EAAMjB,IACzCC,EAAQ,EACRD,EAAWiB,GAEfG,sBAAsBlB,QAK9B,SAAqCC,EAASE,GAC1C,IAAMgB,EAAYC,SAASC,cAAc,OACzCF,EAAUG,GAAK,QACfH,EAAUI,MAAMC,QAAU,sMAQ1BL,EAAUM,WAAexB,EAAU,uBAAyB,KAAKE,EAAgB,mCAAqC,IACtHiB,SAASM,KAAKC,YAAYR,GAC1B,IAAMS,EAAiBR,SAASS,cAAc,UACxCC,EAAMC,OAAOC,aAAeJ,EAAiBA,EAAeK,aAAe,GACjFd,EAAUI,MAAMO,IAAMA,EAAM,GAAK,KAkBjCI,CAA4BjC,EAASE,GAErC,IAAMgC,EAAoBf,SAASS,cAAc,cAC3CO,EAAehB,SAASS,cAAc,QAE5CQ,YAAY,WACR5C,GAAa0C,IAAsBA,EAAkBV,UAAY,cAAchC,GAC/EC,GAAO0C,IAAiBA,EAAaX,UAAY,QAAQ/B,IAC1D,KAEHqC,OAAOO,iBAAiB,SAAU,WAAM,OAxBlCV,EAAiBR,SAASS,cAAc,eAC9CU,WAAW,WACP,IAAMpB,EAAYC,SAASoB,eAAe,SACtCrB,IACAA,EAAUI,MAAMO,IAAMC,OAAOC,aAAeJ,EAAiBA,EAAeK,aAAe,GAAK,GAAK,OAE1G,KAPP,IACUL,aClDMa,EAAK7D,GACjB,IAAMG,EAAa,GACb0D,EAAO1D,EAAWC,SAASK,KAAKT,GAGtC,OAAc,MAAVA,EAAuBA,EAAS,IAFjB,uEAIR8D,MAAM,KAAKC,QAAQ,SAACF,GAC3B1D,EAAW,WAAW0D,OAAWA,EAAKG,gBAGP,iBAAXhE,GACO,mBAAXA,EACMG,EAAW0D,IAAS,gBAAkB7D,uBClB3CiE,GA4CrB,OA3CAA,EAAOC,UAAY,GAEnBD,EAAOE,GAAK,SAACC,EAAmBC,GAC5B,OAAKD,GAAcC,IACdJ,EAAO3D,eAAe,cAAc2D,EAAOC,YAAcD,EAAOC,UAAY,IAGlEE,EAAUN,MAAM,KACxBQ,IAAI,SAACF,IACPG,EAAON,EAAOC,WAAWE,KAAeG,EAAKH,GAAa,IAC3DH,EAAOC,UAAUE,GAAWI,KAAKH,MAG9BJ,EAPP,IAAIM,GAURN,EAAOQ,KAAO,eAAC,aAAA1C,mBAAAA,IAAAC,kBAYX,OAXkBA,EAAK0C,QACEZ,MAAM,KACxBQ,IAAI,SAACF,GACR,IAAMO,EAA4B,OAArBV,EAAOC,WAAqBD,EAAOC,UAAUE,IAAmB,GACzEO,EAAKC,QACLD,EAAKL,IAAI,SAACO,GACNA,GAAQA,EAAKC,MAAMb,EAAQjC,OAKhCiC,GAGXA,EAAOc,IAAM,eAAC,aAAAhD,mBAAAA,IAAAC,kBASV,OARoB,IAAhBA,EAAK4C,OACLX,EAAOC,UAAY,GAEDlC,EAAK0C,QACEZ,MAAM,KACxBQ,IAAI,SAACF,GAAc,cAAOH,EAAOC,UAAUE,KAG/CH,GAGJA,qBHpBKe,QAAkB,IAC1BC,EACAC,EACAC,EACAC,EACAC,EACAC,WAN0BvD,mBAAAA,IAAAC,kBAO9B,IAAIiC,EAASsB,UAAU,IAAM,GACzB/D,EAAI,EACJoD,EAASW,UAAUX,OACnBY,GAAO,EAiBX,IAfsB,kBAAXvB,IACPuB,EAAOvB,EACPA,EAASsB,UAAU/D,IAAM,GACzBA,KAGkB,iBAAXyC,GAAyC,mBAAXA,IACrCA,EAAS,IAGTzC,IAAMoD,IACNX,EAASwB,KACTjE,KAGGA,EAAIoD,EAAQpD,IAEf,GAAiC,QAA5ByD,EAAUM,UAAU/D,IACrB,IAAK0D,KAAQD,EACT,GAAIA,EAAQ3E,eAAe4E,GAAO,CAI9B,GAHAG,EAASpB,EAAOiB,GAGZjB,KAFJmB,EAAOH,EAAQC,IAGX,SAKAM,GAAQJ,IAASrF,EAAcqF,KAAUE,EAAcI,MAAMC,QAAQP,MAGjED,EAFAG,GACAA,GAAc,EACND,GAAUK,MAAMC,QAAQN,GAAUA,EAAS,IAE3CA,GAAUtF,EAAcsF,GAAUA,EAAS,GAGvDpB,EAAOiB,GAAQF,EAAOQ,EAAML,EAAOC,SACnBQ,IAATR,IACPnB,EAAOiB,GAAQE,GAOnC,OAAOnB,oBE7DWjE,EAAgB6F,GAClC,GAAsB,iBAAX7F,EACP,IAAK,IAAM8F,KAAO9F,EAAQ,CAClBA,EAAOM,eAAewF,IAEtBD,EAAGC,EADW9F,EAAO8F,0BAuDZZ,GACrB,IAAMa,EAASC,SAASD,OASxB,OAR6B,KAAXA,EACcA,EAAOE,MAAM,GAAK,IACtBnC,MAAM,KACZoC,OAAO,SAACC,EAAWC,GAC/B,IAAAC,eAACC,OAAMC,OAEb,OADAJ,EAAKG,GAAQE,mBAAmBD,GACzBJ,GACR,IACUjB,eA1DO,SAACuB,EAAWC,GAChC,GAAmB,WAAf7C,EAAK4C,GAAoB,OAAOA,EAGpC,IAFA,IAAIE,EAAQF,EACNG,EAASF,EAAI5C,MAAM,KAChBtC,EAAI,EAAGqF,EAAID,EAAOhC,OAAQpD,EAAIqF,EAAGrF,IAAK,CAC3C,IAAMsF,EAAIF,EAAOpF,GACjB,GAAIsF,EAAG,CACH,IAAIH,EAAMG,GAEH,CACHH,OAAQf,EACR,MAHAe,EAAQA,EAAMG,IAO1B,OAAOH,sBA8Ca1C,GACpB,MAAsB,iBAAXA,EAC+B,IAA/BvD,OAAOqG,KAAK9C,GAAQW,UACpBc,MAAMC,QAAQ1B,IAA6B,iBAAXA,IACd,IAAlBA,EAAOW,mBA/CE,SAACoC,EAAUlB,EAAaa,GAC5C,GAAkB,WAAd9C,EAAKmD,GACL,MAAM,IAAIC,MAAM,kCAEhB,IAAMC,EAASpB,EAAIqB,OAAOC,QAAQ,KAClC,GAAa,EAATF,GAAcA,EAASpB,EAAIlB,OAAS,EAAG,CAIvC,IAHA,IAAMgC,EAASd,EAAIqB,OAAOrD,MAAM,KAC5BuD,EAAOL,EACPM,EAAW,GACN9F,EAAI,EAAGqF,EAAID,EAAOhC,OAAS,EAAGpD,EAAIqF,EAAGrF,IAAK,CAC/C,IAAMsF,EAAIF,EAAOpF,GACM,iBAAZ6F,EAAKP,GACZO,EAAOA,EAAKP,QACc,IAAZO,EAAKP,KACnBQ,EAAWR,GAInB,GAAKQ,EAID,MAAM,IAAIL,MAAM,WAAWK,0BAF3BD,EADgBT,EAAOA,EAAOhC,OAAS,IACvB+B,OAKpBK,EAAIlB,EAAIyB,QAAQ,MAAO,KAAOZ,8BDOV1F,GAC5B,oBAD4BA,GAAqB,MAAO,eACjD,SAACuG,GAAe,OAAAA,EAAMrD,GAAG,UAAW,SAACkC,GAAa,OAAAtF,SAA4BE,6DGjFjEwG,GACpB,OAAO,SAAaxD,IACAyB,MAAMC,QAAQ8B,GAAUA,EAAS,CAACA,IAC1CnD,IAAI,SAACoD,GACT,GAAqB,mBAAVA,EAGP,MAAMT,MAAM,kCAAkCQ,0BAF9CC,EAAMzD"}